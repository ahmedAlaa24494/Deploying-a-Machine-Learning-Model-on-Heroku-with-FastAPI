schema: '2.0'
stages:
  load_clean:
    cmd: python  src/stages/data_cleaning.py --config=params.yaml
    deps:
    - path: data/census.csv
      md5: 171eff96d34336df1a3d2d82bdb82fe3
      size: 3811654
    - path: src/stages/data_cleaning.py
      md5: 168d678df8f93c0ac9a502cc91ef318c
      size: 1115
    - path: src/utils/data_clean.py
      md5: d52d69c3c10023cd3028a725e65ab9f8
      size: 664
    params:
      params.yaml:
        load_clean:
          dataset: data/census.csv
          output: data/clean_census.csv
    outs:
    - path: data/clean_census.csv
      md5: 2446793aa822b145867de72dbe24bd28
      size: 2882004
  test_clean:
    cmd: pytest  src/stages/test_data_cleaning.py
    deps:
    - path: data/clean_census.csv
      md5: 2446793aa822b145867de72dbe24bd28
      size: 2882004
    - path: src/stages/test_data_cleaning.py
      md5: 28067080dcf55484861d12741057ee55
      size: 458
    - path: src/utils/data_clean.py
      md5: d52d69c3c10023cd3028a725e65ab9f8
      size: 664
  data_split:
    cmd: python src/stages/data_split.py --config params.yaml
    deps:
    - path: data/clean_census.csv
      md5: 2446793aa822b145867de72dbe24bd28
      size: 2882004
    - path: src/stages/data_split.py
      md5: e14d539b3dc076efa28a9ad6fba9c99f
      size: 1088
    params:
      params.yaml:
        base.random_state: 42
        data_split:
          dataset: data/clean_census.csv
          test_size: 0.2
          output: data/train
    outs:
    - path: data/train/test_set.csv
      md5: aa45eb953a5d9b4e93b32b64b9e0e294
      size: 576129
    - path: data/train/train_set.csv
      md5: c285d916841a375970867a6d0894ce07
      size: 2305984
  preprocess:
    cmd: python src/stages/preprocess.py --config=params.yaml
    deps:
    - path: data/train/test_set.csv
      md5: aa45eb953a5d9b4e93b32b64b9e0e294
      size: 576129
    - path: data/train/train_set.csv
      md5: c285d916841a375970867a6d0894ce07
      size: 2305984
    - path: src/ml_model/data.py
      md5: 580646f157767ed4c3d701013b4cf029
      size: 3005
    params:
      params.yaml:
        preprocess:
          target: salary
          categorical_features:
          - workclass
          - education
          - marital-status
          - occupation
          - relationship
          - race
          - sex
          - native-country
          numerical_features:
          - age
          - hours-per-week
          encoders_dir: artifacts/encoders
          output_dir: data/train/features
    outs:
    - path: artifacts/encoders/cat_features_encoder.gz
      md5: ba80140a9e812f7040a06a128d43d153
      size: 1517
    - path: artifacts/encoders/label_encoder.gz
      md5: 2dbc4d396f9a0324a7807f5a55ab27f7
      size: 314
    - path: artifacts/encoders/num_features_encoder.gz
      md5: 4ef086f9c4429bc62fb90084999e55e1
      size: 452
    - path: data/train/features/x_test.npy
      md5: 37ba2baaf31f8ff9e73aeabaa2cf95ee
      size: 4778264
    - path: data/train/features/x_train.npy
      md5: eb2696f676ae4864ade489f92634775b
      size: 19110296
    - path: data/train/features/y_test.npy
      md5: 24cfdff6174a1a6f7743e7ec4f04ff32
      size: 48392
    - path: data/train/features/y_train.npy
      md5: c2a354916d3b8c3fc92697215dfb0660
      size: 193160
  train_model:
    cmd: python src/stages/train_model.py --config=params.yaml
    deps:
    - path: artifacts/encoders/cat_features_encoder.gz
      md5: ba80140a9e812f7040a06a128d43d153
      size: 1517
    - path: artifacts/encoders/label_encoder.gz
      md5: 2dbc4d396f9a0324a7807f5a55ab27f7
      size: 314
    - path: artifacts/encoders/num_features_encoder.gz
      md5: 4ef086f9c4429bc62fb90084999e55e1
      size: 452
    - path: data/train/features/x_test.npy
      md5: 37ba2baaf31f8ff9e73aeabaa2cf95ee
      size: 4778264
    - path: data/train/features/x_train.npy
      md5: eb2696f676ae4864ade489f92634775b
      size: 19110296
    - path: data/train/features/y_test.npy
      md5: 24cfdff6174a1a6f7743e7ec4f04ff32
      size: 48392
    - path: data/train/features/y_train.npy
      md5: c2a354916d3b8c3fc92697215dfb0660
      size: 193160
    - path: src/ml_model/data.py
      md5: 580646f157767ed4c3d701013b4cf029
      size: 3005
    - path: src/ml_model/model.py
      md5: bf416fad3cf5dc7e9cce0ccda985ee1d
      size: 1568
    params:
      params.yaml:
        preprocess:
          target: salary
          categorical_features:
          - workclass
          - education
          - marital-status
          - occupation
          - relationship
          - race
          - sex
          - native-country
          numerical_features:
          - age
          - hours-per-week
          encoders_dir: artifacts/encoders
          output_dir: data/train/features
        train:
          model_type: GradientBoostingClassifier
          hp:
            learning_rate: 0.1
            max_depth: 5
            min_samples_leaf: 1
            min_samples_split: 3
            n_estimators: 50
          model_artifact: artifacts/model/census-gradient-boosting-classifier.gz
    outs:
    - path: artifacts/model/census-gradient-boosting-classifier.gz
      md5: a41da2a4bc646882a2c678729308fc59
      size: 98312
    - path: reports/metrics.json
      md5: 85123016f1c3fca53d5cfed7ab131567
      size: 136
  slice_validation:
    cmd: python  src/stages/slice_check.py --config=params.yaml
    deps:
    - path: artifacts/encoders/cat_features_encoder.gz
      md5: ba80140a9e812f7040a06a128d43d153
      size: 1517
    - path: artifacts/encoders/label_encoder.gz
      md5: 2dbc4d396f9a0324a7807f5a55ab27f7
      size: 314
    - path: artifacts/encoders/num_features_encoder.gz
      md5: 4ef086f9c4429bc62fb90084999e55e1
      size: 452
    - path: artifacts/model/census-gradient-boosting-classifier.gz
      md5: a41da2a4bc646882a2c678729308fc59
      size: 98312
    - path: src/stages/slice_check.py
      md5: 3664fecf7fb5261f1b78840e6f4d2ad8
      size: 2954
    params:
      params.yaml:
        preprocess:
          target: salary
          categorical_features:
          - workclass
          - education
          - marital-status
          - occupation
          - relationship
          - race
          - sex
          - native-country
          numerical_features:
          - age
          - hours-per-week
          encoders_dir: artifacts/encoders
          output_dir: data/train/features
        train:
          model_type: GradientBoostingClassifier
          hp:
            learning_rate: 0.1
            max_depth: 5
            min_samples_leaf: 1
            min_samples_split: 3
            n_estimators: 50
          model_artifact: artifacts/model/census-gradient-boosting-classifier.gz
    outs:
    - path: reports/slice_output.txt
      md5: 2d6591f8366f00ee43ce267f2dda1774
      size: 8267
  test_model_infer:
    cmd: pytest  src/stages/test_model_steps.py
    deps:
    - path: artifacts/encoders/cat_features_encoder.gz
      md5: ba80140a9e812f7040a06a128d43d153
      size: 1517
    - path: artifacts/encoders/label_encoder.gz
      md5: 2dbc4d396f9a0324a7807f5a55ab27f7
      size: 314
    - path: artifacts/encoders/num_features_encoder.gz
      md5: 4ef086f9c4429bc62fb90084999e55e1
      size: 452
    - path: artifacts/model/census-gradient-boosting-classifier.gz
      md5: a41da2a4bc646882a2c678729308fc59
      size: 98312
    - path: src/stages/test_model_steps.py
      md5: 697b6d4524b6dc2524dfa577b9742100
      size: 3767
    params:
      params.yaml:
        preprocess:
          target: salary
          categorical_features:
          - workclass
          - education
          - marital-status
          - occupation
          - relationship
          - race
          - sex
          - native-country
          numerical_features:
          - age
          - hours-per-week
          encoders_dir: artifacts/encoders
          output_dir: data/train/features
        train:
          model_type: GradientBoostingClassifier
          hp:
            learning_rate: 0.1
            max_depth: 5
            min_samples_leaf: 1
            min_samples_split: 3
            n_estimators: 50
          model_artifact: artifacts/model/census-gradient-boosting-classifier.gz
