schema: '2.0'
stages:
  load_clean:
    cmd: python  src/stages/data_cleaning.py --config=params.yaml
    deps:
    - path: data/census.csv
      md5: 171eff96d34336df1a3d2d82bdb82fe3
      size: 3811654
    - path: src/stages/data_cleaning.py
      md5: 76cd83009321921cd382d85c2c4ce3cc
      size: 1160
    - path: src/utils/data_clean.py
      md5: ae10580b898bb85ea1b0429a7d6c243d
      size: 663
    params:
      params.yaml:
        load_clean:
          dataset: data/census.csv
          output: data/clean_census.csv
    outs:
    - path: data/clean_census.csv
      md5: 2446793aa822b145867de72dbe24bd28
      size: 2882004
  test_clean:
    cmd: pytest  src/stages/test_data_cleaning.py
    deps:
    - path: data/clean_census.csv
      md5: 2446793aa822b145867de72dbe24bd28
      size: 2882004
    - path: src/stages/test_data_cleaning.py
      md5: 7ff133e9da846875cebc8f78aaa6e1f4
      size: 472
    - path: src/utils/data_clean.py
      md5: ae10580b898bb85ea1b0429a7d6c243d
      size: 663
  data_split:
    cmd: python src/stages/data_split.py --config params.yaml
    deps:
    - path: data/clean_census.csv
      md5: 2446793aa822b145867de72dbe24bd28
      size: 2882004
    - path: src/stages/data_split.py
      md5: 734f57e1374f3834ad7a803314b4fde1
      size: 1143
    params:
      params.yaml:
        base.random_state: 42
        data_split:
          dataset: data/clean_census.csv
          test_size: 0.2
          output: data/train
    outs:
    - path: data/train/test_set.csv
      md5: b12800e762da3b722047c35a5be1c85f
      size: 576493
    - path: data/train/train_set.csv
      md5: da5f92c5fad2ded4279d44217c4fe483
      size: 2305620
  preprocess:
    cmd: python src/stages/preprocess.py --config=params.yaml
    deps:
    - path: data/train/test_set.csv
      md5: b12800e762da3b722047c35a5be1c85f
      size: 576493
    - path: data/train/train_set.csv
      md5: da5f92c5fad2ded4279d44217c4fe483
      size: 2305620
    - path: src/ml_model/data.py
      md5: 0997995154296698a993562358c8cbe3
      size: 3087
    params:
      params.yaml:
        preprocess:
          target: salary
          categorical_features:
          - workclass
          - education
          - marital-status
          - occupation
          - relationship
          - race
          - sex
          - native-country
          numerical_features:
          - age
          - hours-per-week
          encoders_dir: artifacts/encoders
          output_dir: data/train/features
    outs:
    - path: artifacts/encoders/cat_features_encoder.gz
      md5: a50016694d0a757d05f561e9558aec9f
      size: 1532
    - path: artifacts/encoders/label_encoder.gz
      md5: 2dbc4d396f9a0324a7807f5a55ab27f7
      size: 314
    - path: artifacts/encoders/num_features_encoder.gz
      md5: 0823553960816f2b0677ac2afe018fb1
      size: 456
    - path: data/train/features/x_test.npy
      md5: 44790e8c8c633b1c137af29d7c1de3e4
      size: 4826528
    - path: data/train/features/x_train.npy
      md5: 67100521dea6d18c73ffb867a0389c80
      size: 19303328
    - path: data/train/features/y_test.npy
      md5: c75de91da964c2ed8bdb8117a2fcb43d
      size: 48392
    - path: data/train/features/y_train.npy
      md5: b2250f40ceb2750882f4c458b0d0f3a5
      size: 193160
  train_model:
    cmd: python src/stages/train_model.py --config=params.yaml
    deps:
    - path: artifacts/encoders/cat_features_encoder.gz
      md5: a50016694d0a757d05f561e9558aec9f
      size: 1532
    - path: artifacts/encoders/label_encoder.gz
      md5: 2dbc4d396f9a0324a7807f5a55ab27f7
      size: 314
    - path: artifacts/encoders/num_features_encoder.gz
      md5: 0823553960816f2b0677ac2afe018fb1
      size: 456
    - path: data/train/features/x_test.npy
      md5: 44790e8c8c633b1c137af29d7c1de3e4
      size: 4826528
    - path: data/train/features/x_train.npy
      md5: 67100521dea6d18c73ffb867a0389c80
      size: 19303328
    - path: data/train/features/y_test.npy
      md5: c75de91da964c2ed8bdb8117a2fcb43d
      size: 48392
    - path: data/train/features/y_train.npy
      md5: b2250f40ceb2750882f4c458b0d0f3a5
      size: 193160
    - path: src/ml_model/data.py
      md5: 0997995154296698a993562358c8cbe3
      size: 3087
    - path: src/ml_model/model.py
      md5: ea891a9bb813e4f5ce2ed4e30fedcaf6
      size: 1574
    params:
      params.yaml:
        preprocess:
          target: salary
          categorical_features:
          - workclass
          - education
          - marital-status
          - occupation
          - relationship
          - race
          - sex
          - native-country
          numerical_features:
          - age
          - hours-per-week
          encoders_dir: artifacts/encoders
          output_dir: data/train/features
        train:
          model_type: GradientBoostingClassifier
          hp:
            learning_rate: 0.1
            max_depth: 5
            min_samples_leaf: 1
            min_samples_split: 3
            n_estimators: 100
          model_artifact: artifacts/model/census-gradient-boosting-classifier.gz
    outs:
    - path: artifacts/model/census-gradient-boosting-classifier.gz
      md5: e051ef2e876d3480431ef1c01acd75de
      size: 172950
    - path: reports/metrics.json
      md5: e8cb42e17f2368bf968d1cf99ea4c151
      size: 123
  slice_validation:
    cmd: python  src/stages/slice_check.py --config=params.yaml
    deps:
    - path: artifacts/encoders/cat_features_encoder.gz
      md5: a50016694d0a757d05f561e9558aec9f
      size: 1532
    - path: artifacts/encoders/label_encoder.gz
      md5: 2dbc4d396f9a0324a7807f5a55ab27f7
      size: 314
    - path: artifacts/encoders/num_features_encoder.gz
      md5: 0823553960816f2b0677ac2afe018fb1
      size: 456
    - path: artifacts/model/census-gradient-boosting-classifier.gz
      md5: e051ef2e876d3480431ef1c01acd75de
      size: 172950
    - path: src/stages/slice_check.py
      md5: 1199295f9d21638e408c5c492e422be5
      size: 2823
    params:
      params.yaml:
        preprocess:
          target: salary
          categorical_features:
          - workclass
          - education
          - marital-status
          - occupation
          - relationship
          - race
          - sex
          - native-country
          numerical_features:
          - age
          - hours-per-week
          encoders_dir: artifacts/encoders
          output_dir: data/train/features
        train:
          model_type: GradientBoostingClassifier
          hp:
            learning_rate: 0.1
            max_depth: 5
            min_samples_leaf: 1
            min_samples_split: 3
            n_estimators: 100
          model_artifact: artifacts/model/census-gradient-boosting-classifier.gz
    outs:
    - path: reports/slice_output.txt
      md5: 30f9eae4e599f93e04deb3b2f16479a9
      size: 8216
  test_model_infer:
    cmd: pytest  src/stages/test_model_steps.py
    deps:
    - path: artifacts/encoders/cat_features_encoder.gz
      md5: a50016694d0a757d05f561e9558aec9f
      size: 1532
    - path: artifacts/encoders/label_encoder.gz
      md5: 2dbc4d396f9a0324a7807f5a55ab27f7
      size: 314
    - path: artifacts/encoders/num_features_encoder.gz
      md5: 0823553960816f2b0677ac2afe018fb1
      size: 456
    - path: artifacts/model/census-gradient-boosting-classifier.gz
      md5: e051ef2e876d3480431ef1c01acd75de
      size: 172950
    - path: src/stages/test_model_steps.py
      md5: e222eea6220eadbd9bb4226614ce418b
      size: 3576
    params:
      params.yaml:
        preprocess:
          target: salary
          categorical_features:
          - workclass
          - education
          - marital-status
          - occupation
          - relationship
          - race
          - sex
          - native-country
          numerical_features:
          - age
          - hours-per-week
          encoders_dir: artifacts/encoders
          output_dir: data/train/features
        train:
          model_type: GradientBoostingClassifier
          hp:
            learning_rate: 0.1
            max_depth: 5
            min_samples_leaf: 1
            min_samples_split: 3
            n_estimators: 100
          model_artifact: artifacts/model/census-gradient-boosting-classifier.gz
